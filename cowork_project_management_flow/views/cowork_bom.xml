<?xml version="1.0" encoding="utf-8"?>
<odoo>
     <record model="ir.ui.view" id="view_form_cowork_scheme_preliminary_inherit">
        <field name="name">cowork.scheme.preliminary.inherit</field>
        <field name="model">cowork.scheme.preliminary</field>
        <field name="inherit_id" ref="cowork_project_management_flow.view_form_cowork_scheme_preliminary"/>
        <field name="arch" type="xml">
            <data>
                <xpath expr="//div[@name='button_box']" position="inside">
                    <button type="object" class="oe_stat_button" icon="fa-briefcase" string="项目报价" name="button_to_requisition" attrs="{'invisible':[('quote_id','=',False)]}"/>
                </xpath>
            </data>
        </field>
    </record>

    <record model="ir.ui.view" id="view_form_cowork_bom">
        <field name="name">设计方案</field>
        <field name="model">cowork.bom</field>
        <field name="arch" type="xml">
            <form string="设计方案">
                <header>
                    <!-- <button name="get_material_info" string="获取组件信息" type="object" class="oe_highlight" states="draft"/> -->
                    <button name="button_approval" string="提交" type="object" class="oe_highlight"  states="draft"/>
                    <button name="button_confirm" string="确认" type="object" class="oe_highlight"  states="approval" groups="cowork_project_management_flow.access_group_technique_director_in_cowork_project_management_flow"/>
                    <button name="button_return" string="驳回" type="object" class="oe_highlight"  states="approval" groups="cowork_project_management_flow.access_group_technique_director_in_cowork_project_management_flow"/>
                    <button name="action_to_requisition" string="新建/更新采购申请" type="object" class="oe_highlight"  states="confirm" groups="cowork_project_management_flow.access_group_project_manager_in_cowork_project_management_flow"/>
                    <button name="button_to_return" string="驳回" type="object" class="oe_highlight"  states="confirm" groups="cowork_project_management_flow.access_group_project_manager_in_cowork_project_management_flow"/>

                    <field name="state" widget="statusbar" statusbar_visible="draft,approval,confirm" readonly="1"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button type="object" class="oe_stat_button" icon="fa-shopping-cart" string="申购明细" name="action_to_cowork_purchase"/>
                    </div>
                    <h1>
                        <field name="name" readonly="1"/>
                    </h1>
                    <group>
                        <field name="project_id" readonly="1" required="1"/>
                    </group>
                    <group string="图纸">
                        <field name="mechaine_pic" widget="url"/>
                        <field name="electric_pic" widget="url"/>
                    </group>
                    <group>
                        <group>
                            <field name="count"/>
                        </group>
                    </group>
                    <!-- <group>
                        <button type="object" class="oe_highlight" name="cowork_create" string="添加明细"/>
                    </group> -->
                    <!-- <group>
                        <field name="material_cost_details_lines">
                            <tree editable="bottom">
                                <field name="class_id"/>
                                <field name="name"/>
                                <field name="count"/>
                                <button type="object" class="oe_highlight" name="edit_spare_parts" string="编辑组件"/>
                            </tree>
                        </field>
                    </group> -->
                    <hr/>
                    <button name="%(import_bom_line_action)d" 
                    string="导入BOM明细"
                    icon="fa-upload"
                    type="action" 
                    class="oe_stat_button"  attrs="{'invisible':[('state','!=','draft')]}"/>
                    <group string="单台BOM明细">
                        <group>
                            <button type="object" class="oe_highlight" name="cowork_create" string="添加明细"/>
                        </group>
                        <field name="spare_parts_lines" nolabel="1" attrs="{'readonly':[('state','!=','draft')]}">
                            <tree editable="bottom" limit="10" create="0" delete="0">
                                <field name="class_categ_id"/>
                                <field name="categ_id"/>
                                <field name="product_tmpl_id" domain="[('categ_id','=',categ_id)]" context="{'default_categ_id':categ_id}"/>
                                <field name="default_code"/>
                                <field name="count"/>
                                <field name="uom_id"/>
                                <field name="material"/>
                                <field name="class_id"/>
                                <field name="brand_id"/>
                                <field name="comments"/>
                                <button type="object" class="oe_highlight" name="cowork_write" string="明细变更"/>
                                <button type="object" class="oe_highlight" name="cowork_delete" string="删除明细" confirm="是否确认删除"/>
                            </tree>
                        </field>
                    </group>
                    <group name="cowork_message_ids" string="明细变更操作记录">
                        <field name="cowork_message_ids" readonly="1" nolabel="1">
                            <tree editable="bottom" limit="10">
                                <field name="user_id"/>
                                <field name="date"/>
                                <field name="operate"/>
                            </tree>
                        </field>
                    </group>
                    
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <record model="ir.ui.view" id="view_form_cowork_bom_material">
        <field name="name">组件物料</field>
        <field name="model">cowork.bom.material</field>
        <field name="arch" type="xml">
            <form string="组件物料">
                <sheet>
                    <div class="oe_button_box" name="button_box">
                    </div>
                    <group>
                        <field name="name" readonly="1"/>
                        <field name="class_id" readonly="1"/>
                        <field name="preliminary_scheme_id" readonly="1"/>
                    </group>
                    <group>
                        <field name="count"/>
                    </group>
                    <group string="单件零部件明细">
                        <field name="spare_parts_lines" nolabel="1">
                            <tree editable="bottom">
                                <field name="categ_id"/>
                                <field name="product_tmpl_id" domain="[('categ_id','=',categ_id)]" context="{'default_categ_id':categ_id}"/>
                                <field name="brand_id"/>
                                <field name="count"/>
                                <field name="uom_id"/>
                                <field name="comments"/>
                            </tree>
                        </field>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record model="ir.ui.view" id="view_tree_cowork_bom">
        <field name="name">方案设计</field>
        <field name="model">cowork.bom</field>
        <field name="arch" type="xml">
            <tree string="方案设计" default_order="write_date desc">
                <field name="name"/>
                <field name="project_id"/>
            </tree>
        </field>
    </record>
    <record model="ir.actions.act_window" id="action_cowork_bom">
        <field name="name">方案设计</field>
        <field name="res_model">cowork.bom</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
    </record>

        <!-- <menuitem id="menu_ps_purchase_requistion_cowork" name="采购申请" parent="menu_cowork_plan_design_root" sequence="2" action="ps_purchase.ps_purchase_requisition_action"/> -->

    <!-- <record model="ir.ui.view" id="ps_purchase_requisition_inherit_cowork_form_bom">
        <field name="name">bom ps purchase order inherit cowork</field>
        <field name="model">ps.purchase.requisition</field>
        <field name="inherit_id" ref="ps_purchase.ps_purchase_requisition_form_view_id"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='create_uid']" position="after">
                <field name="sale_cowork_id" options="{'no_create_edit': True}"/>
            </xpath>
            <xpath expr="//field[@name='line_ids']/tree/field[@name='state']" position="after">
                <field name="approval" invisible="1"/>
            </xpath>
        </field>
    </record>
    <record model="ir.ui.view" id="view_tree_ps_purchase_requisition_line">
        <field name="name">采购申请明细</field>
        <field name="model">ps.purchase.requisition.line</field>
        <field name="arch" type="xml">
            <tree string="采购申请明细" default_order="write_date desc" create="0">
                <field name="categ_id"/>
                <field name="product_id"/>
                <field name="ps_partner_id"/>
                <field name="product_qty"/>
                <field name="value_qty"/>
                <field name="product_uom_id"/>
                <field name="plan_date"/>
                <field name="approval"/>
                <button type="object" class="oe_highlight" name="edit_to_purchase" string="采购申请"/>
            </tree>
        </field>
    </record>
    <record model="ir.actions.act_window" id="action_ps_purchase_requisition_line">
        <field name="name">采购申请明细</field>
        <field name="res_model">ps.purchase.requisition.line</field>
        <field name="view_mode">tree</field>
    </record>
    <menuitem id="menu_ps_purchase_requistion_line_cowork" name="采购申请明细" parent="menu_cowork_plan_design_root" sequence="3" action="action_ps_purchase_requisition_line"/>

    <record id="action_ps_purchase_requisition_line_1" model="ir.actions.server">
        <field name="name">同意</field>
        <field name="model_id" ref="ps_purchase.model_ps_purchase_requisition_line"/>
        <field name="state">code</field>
        <field name="code">
        if records:
            action = records.action_approval()
        </field>
    </record>
    <record id="action_ps_purchase_requisition_line_2" model="ir.actions.server">
        <field name="name">不同意</field>
        <field name="model_id" ref="ps_purchase.model_ps_purchase_requisition_line"/>
        <field name="state">code</field>
        <field name="code">
        if records:
            action = records.action_disapproval()
        </field>
    </record> -->
    <record id="view_picking_form_inherit_cowork_" model="ir.ui.view">
        <field name="name">stock.picking.form.inherit.cowork</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='origin']" position="after">
                <field name="project_id" options="{'no_create_edit':True,'no_open':True}"/>
            </xpath>
            <xpath expr="//field[@name='move_ids_without_package']/tree/field[@name='product_id']" position="before">
                <field name="project_id"/>
            </xpath>
        </field>
    </record>
</odoo>